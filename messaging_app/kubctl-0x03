#!/bin/bash

set -e

echo "ğŸš€ Applying updated blue deployment with image v2.0..."
kubectl apply -f messaging_app/blue_deployment.yaml

echo "ğŸ“¡ Monitoring rollout status..."
kubectl rollout status deployment/django-blue

echo "ğŸ” Verifying pods..."
kubectl get pods -l app=django -o wide

# Get service URL (works for Minikube; adjust if using LoadBalancer or NodePort)
APP_URL=$(minikube service django-service --url)

echo "ğŸŒ Testing app availability during rollout..."
for i in {1..20}; do
  curl -s $APP_URL/ || echo "âš ï¸ Request failed"
  sleep 1
done

echo "âœ… Rolling update completed successfully!"

